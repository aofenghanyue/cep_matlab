% =========================================================================
% GJB 6289-2008 命中精度评定方法 - MATLAB 实现主脚本
% =========================================================================
%
% 说明:
%   此脚本是主入口点。只需在此文件中定义落点偏差数据，
%   然后运行此脚本，即可获得CEP的点估计和置信区间。
%
% 使用方法:
%   1. 在 "输入数据" 部分填入纵向(x)和横向(z)落点偏差数据。
%   2. (可选) 修改置信水平 alpha。
%   3. 运行此脚本 (按 F5)。
%   4. 在命令窗口查看格式化的输出结果。
%
%--------------------------------------------------------------------------

clear; clc; close all;

%% 1. 输入数据
% -------------------------------------------------------------------------
% 在这里输入数据。
% --- 常规方法数据 (n > 3) ---
% %  GJB 6289-2008 中示例1 (表1) 的数据。
% % n = 4
% x_data_std = [71.94, -133.69, 326.74, 207.17];
% z_data_std = [123.03, 29.31, 275.98, 115.64];
%  GJB 6289-2008 中示例2 (表2) 的数据。
% n = 9
x_data_std = [55.85, 136.95, 92.41, 59.15, 64.08, 88.09, 60.57, -16.19, 21.31];
z_data_std = [-97.67, 57.60, 132.20, 2.63, -31.03, 207.75, -205.99, 3.04, -13.22];

% --- 贝叶斯方法数据 (n <= 3) ---
% 使用 GJB 6289-2008 中示例 (表4) 的数据进行验证。
% 试验样本 (n=3)
x_test_bayes = [-441.4, 465.3, -1244.7];
z_test_bayes = [642.3, -1528.0, -352.4];
% 补充样本 (n0=3)
x_supp_bayes = [-882.2, 680.2, 98.5];
z_supp_bayes = [230.4, -537.8, 1215.3];

%% 2. 设置参数
% -------------------------------------------------------------------------
% 假设检验的显著性水平 (规范推荐 0.10)
test_alpha = 0.10;
% -------------------------------------------------------------------------
% 设置置信水平 (1 - alpha)
% 例如: 0.90 代表 90% 的置信水平
confidence_level_std = 0.80;   % 用于常规方法
confidence_level_bayes = 0.80; % 用于贝叶斯方法

% 设置模拟次数 (Bootstrap 和 Bayesian)
% 规范建议 1000 ~ 3000 次，2000 是一个比较好的选择。
simulation_iterations = 2000;

%% 3. 调用核心分析函数
%% 3.1 执行常规方法计算 (n > 3)
% -------------------------------------------------------------------------
fprintf('====================================================\n');
fprintf('执行常规精度评定 (GJB 第6、7章)\n');
fprintf('====================================================\n');
fprintf('正在根据 GJB 6289-2008 标准进行计算...\n');
fprintf('样本数量 n = %d\n', length(x_data_std));
fprintf('置信水平 = %.2f%%\n\n', confidence_level_std * 100);

results_std = calculate_cep_analysis(x_data_std, z_data_std, confidence_level_std, simulation_iterations, test_alpha);

% 显示结果
disp_cep_results(results_std, '常规方法');

fprintf('------------------- GJB 示例对比 -----------------\n');
fprintf('GJB 6289-2008 表3中，置信水平为0.90时:\n');
fprintf('  点估计 R̂         = 116.97 m\n');
fprintf('  自助法置信区间   ≈ [91.18, 150.87] m\n');
fprintf('  一阶逼近置信区间 ≈ [91.69, 149.21] m\n');
fprintf('--------------------------------------------------\n\n');


%% 3.2 执行贝叶斯方法计算 (n <= 3)
% -------------------------------------------------------------------------
fprintf('====================================================\n');
fprintf('执行贝叶斯精度评定 (GJB 第8章, 适用于小样本)\n');
fprintf('====================================================\n');
fprintf('试验样本数量 n = %d\n', length(x_test_bayes));
fprintf('补充样本数量 n₀ = %d\n', length(x_supp_bayes));
fprintf('置信水平 = %.2f%%\n\n', confidence_level_bayes * 100);

results_bayes = calculate_cep_bayesian(x_test_bayes, z_test_bayes, ...
    x_supp_bayes, z_supp_bayes, confidence_level_bayes, simulation_iterations);

% 显示结果
disp_cep_bayesian_results(results_bayes);

fprintf('------------------- GJB 示例对比 -----------------\n');
fprintf('GJB 6289-2008 8.3节示例中，置信水平为0.80时:\n');
fprintf('  贝叶斯点估计 R_ba   = 1011.5 m\n');
fprintf('  贝叶斯置信区间      = [722.6, 1374.1] m\n');
fprintf('--------------------------------------------------\n\n');
